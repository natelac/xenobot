#!/bin/bash
# xenobot

# TODO:
# - Check python3.8 is being used
# - Just pass commands directly to controller.py, it will give any errors if it
# is formatted wrong

pipe=tmp/botpipe

usage() {
  echo "Usage: $0 (start [-g guild -p db_path] |"
  echo "           gather [-g guild -p db_path -d earliest_date] |"
  echo "           stop)"
}

check_pipe() {
  if [[ ! -p $pipe ]]; then
    echo "Could not find pipe: $pipe"
    exit 1
  fi
}

main(){
  if [[ ${#} == 0 ]]; then
    $usage;
  fi

  case ${1} in
    start)
      ${1};
      ;;
    gather)
      $check_pipe
      ${1} "${@:2}";
      ;;
    stop)
      $check_pipe
      ${1}
      ;;
    *)
      echo $usage;
      exit 1;
      ;;
  esac
}

start(){
  python3.8 bot.py "$@"
}

gather(){
  echo "$@" >$pipe
  python3.8 gather.py "$@"
}

stop(){
  echo "$@" 
}
  
main "$@";
exit 0
